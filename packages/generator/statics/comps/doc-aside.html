<template component>
  <d-nav>
    <x-fill name="dItem" :value="leftNavs"></x-fill>
  </d-nav>
  <template name="dItem">
    <d-item attr:active="$host.leftGetActive($data)">
      <x-if :value="$data.href">
        <a attr:href="$data.href" olink on:click="$ele.refresh()"
          >{{$data.name}}</a
        >
      </x-if>
      <x-else>
        <span> {{$data.name}}</span>
        <d-nav slot="nav">
          <x-fill :value="$data.childs" name="dItem"></x-fill>
        </d-nav>
      </x-else>
    </d-item>
  </template>

  <script>
    import { leftNavsData } from "../data.mjs";

    export default {
      data: {
        leftNavs: [],
        activeHref: "",
      },
      watch: {
        activeHref() {
          clearTimeout(this._timer);
          this._timer = setTimeout(() => {
            const target = this.shadow.$("d-item[active='']");
            if (!isElementVisible(target.ele)) {
              target.ele.scrollIntoView();
            }
          }, 300);
        },
      },
      proto: {
        leftGetActive(data) {
          if (data.href === this.activeHref) {
            return "";
          }

          return null;
        },
      },
      attached() {
        this.leftNavs = leftNavsData;
      },
      detached() {
        this.leftNavs = [];
      },
    };

    function isElementVisible(element) {
      var rect = element.getBoundingClientRect();

      var windowHeight =
        window.innerHeight || document.documentElement.clientHeight;
      var windowWidth =
        window.innerWidth || document.documentElement.clientWidth;

      var isVisible =
        rect.top < windowHeight &&
        rect.bottom > 0 &&
        rect.left < windowWidth &&
        rect.right > 0;

      return isVisible;
    }
  </script>
</template>
