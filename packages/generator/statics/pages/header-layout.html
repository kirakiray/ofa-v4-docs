<template page>
  <style>
    :host {
      display: block;
      width: 100%;
      height: 100%;
    }
    .mobile-aside {
      margin: 16px 0 0 0;
      padding: 16px;
      border-top: rgba(238, 238, 238, 0.204) solid 1px;
    }
  </style>
  <doc-container>
    <doc-header slot="header">
      <span slot="logo">OFA.js</span>
      <ul>
        <x-fill :value="navs">
          <li class:active="$host.isActive($data)">
            <a attr:href="$data.href" olink>{{$data.name}}</a>
          </li>
        </x-fill>
      </ul>
      <div slot="mobile-aside" class="mobile-aside">
        <x-fill name="item" :value="articles"></x-fill>
      </div>
    </doc-header>
    <slot></slot>
  </doc-container>

  <template name="item">
    <d-item attr:active="$host.leftGetActive($data)">
      <x-if :value="$data.href">
        <a attr:href="$data.href" olink>{{$data.name}}</a>
      </x-if>
      <x-else>
        <span> {{$data.name}}</span>
        <d-nav slot="nav">
          <x-fill :value="$data.childs" name="item"></x-fill>
        </d-nav>
      </x-else>
    </d-item>
  </template>

  <script>
    export default async function ({ load }) {
      const { leftNavsData } = await load("../data.mjs");

      return {
        data: {
          articles: [],
        },
        attached() {
          this.articles = leftNavsData;
        },
        detached() {
          this.articles = [];
        },
        ready() {
          this.attr("id", "header-layout");
        },
        proto: {
          init(data) {
            this.navs = data;
          },
          isActive(data) {
            if (data) {
              const exp = new RegExp(data.active);
              return exp.test(this.app.current.src);
            }
            return false;
          },
          leftGetActive(data) {
            const now = `${location.origin}${location.pathname}`;
            if (data.href === now) {
              return "";
            }

            return null;
          },
        },
        routerChange(e) {
          setTimeout(() => {
            this.shadow.$("doc-container").scrollTop = 0;
          }, 300);
        },
      };
    }
  </script>
</template>
