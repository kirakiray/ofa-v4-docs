<template component>
  <link rel="stylesheet" href="../font/iconfont.css" />
  <style>
    :host {
      display: block;
    }
    .lang-selector {
      position: relative;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 0 8px;
      margin-right: 8px;
      font-size: 14px;
      border-radius: 20px;
      transition: all ease 0.2s;
    }
    .lang-selector:hover {
      background-color: var(--aside-hover-bg);
    }
    .lang-selector select {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    @media screen and (max-width: 800px) {
      .lang-selector .text {
        display: none;
      }
    }
  </style>
  <div class="lang-selector">
    <span
      class="iconfont icon-qiehuanyuyan"
      style="font-size: 20px; margin-right: 4px"
    ></span>
    <span class="text"
      >{{options.find(e => lang === e.value)?.name || ''}}</span
    >
    <select :value="lang" on:change="changeLang">
      <template is="replace-temp">
        <x-fill :value="options">
          <option attr:value="$data.value">{{$data.name}}</option>
        </x-fill>
      </template>
    </select>
  </div>
  <script>
    import { lang } from "../data.mjs";

    export default {
      data: {
        lang,
        options: [
          {
            name: "English",
            value: "en",
          },
          {
            name: "简体中文",
            value: "cn",
          },
          {
            name: "繁体中文",
            value: "t-cn",
          },
          {
            name: "española",
            value: "es",
          },
        ],
      },
      proto: {
        changeLang(e) {
          const val = e.target.value;

          if (val !== lang) {
            window.location = `/${val}/${location.pathname.replace(
              /\/.+?\/(.+)/,
              "$1"
            )}`;
          }

          localStorage.__userlang = val;
        },
      },
      ready() {
        let userLang = localStorage.__userlang;

        if (!userLang) {
          userLang = "en";
          const localLang = navigator.language || navigator.userLanguage;

          if (/^zh\-/.test(localLang)) {
            if (localLang === "zh-CN") {
              userLang = "cn";
            } else {
              userLang = "t-cn";
            }
          } else if (/^es\-/.test(localLang)) {
            userLang = "es";
          }

          if (lang !== userLang) {
            this.changeLang({ target: { value: userLang } });
          }

          localStorage.__userlang = userLang;
        }
      },
    };
  </script>
</template>
