<template page>
  <l-m src="../comps/doc-search.html"></l-m>
  <l-m src="../comps/lang-select.html"></l-m>
  <link rel="stylesheet" href="../font/iconfont.css" />
  <style>
    :host {
      display: block;
      width: 100%;
      height: 100%;
    }
    .mobile-aside {
      margin: 16px 0 0 0;
      padding: 16px;
      border-top: rgba(238, 238, 238, 0.204) solid 1px;
    }
    .github-link {
      font-size: 24px;
      text-decoration: none;
      color: inherit;
      margin-right: 16px;
    }
  </style>
  <doc-container>
    <doc-header slot="header">
      <span slot="logo">OFA.js</span>
      <ul>
        <x-fill :value="navs">
          <li class:active="$host.isActive($data)">
            <a attr:href="$data.href" olink>{{$data.name}}</a>
          </li>
        </x-fill>
      </ul>
      <div slot="mobile-aside" class="mobile-aside">
        <doc-aside slot="aside" :active-href="leftActiveUrl"> </doc-aside>
      </div>
      <a
        class="iconfont icon-github-fill github-link"
        slot="right"
        href="https://github.com/kirakiray/ofa.js"
      ></a>

      <lang-select slot="right"></lang-select>
      <doc-search slot="right" style="margin-right: 16px"></doc-search>
    </doc-header>
    <slot></slot>
  </doc-container>

  <script>
    export default async function ({ load }) {
      const { leftNavsData } = await load("../data.mjs");

      return {
        data: {
          leftActiveUrl: "",
          articles: [],
          navs: [],
        },
        attached() {
          this.articles = leftNavsData;
        },
        detached() {
          this.articles = [];
        },
        ready() {
          this.attr("id", "header-layout");
          this.leftActiveUrl = `${location.origin}${location.pathname}`;
        },
        proto: {
          init(data) {
            data.forEach((e) => {
              e.name = e.name
                .split(" ")
                .map((e2) => e2[0].toUpperCase() + e2.slice(1))
                .join(" ");
            });
            this.navs = data;
          },
          isActive(data) {
            if (data) {
              const exp = new RegExp(data.active);
              return exp.test(this.app.current.src);
            }
            return false;
          },
        },
        routerChange(e) {
          this.leftActiveUrl = `${location.origin}${location.pathname}`;
          this.shadow.$("doc-container").scrollTop = 0;
        },
      };
    }
  </script>
</template>
